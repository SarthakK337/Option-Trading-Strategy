"use strict";define("app/modules/InstrumentPageHeader/InstrumentPageHeaderView",["underscore","jquery","Backbone","Displayable","EventBus","DataChest","AlertActions","PortfolioActions"],function(i,o,t,r,u,s,e,a){o(window);var l="Instrument";return r.extend({_instrumentName:null,_instrumentType:null,_instrumentId:null,_lastVisibleTab:null,_tabsMapByIndex:null,_tabIndexToMoreTab:null,_firstTabOffsetHeight:null,_markupScheme:{"?watchButton":".js-instrument-tools-watch","?watchingButton":".js-instrument-tools-watching","?alertButton":".js-instrument-tools-alert-button","?portfolioButtonWrapper":".js-instrument-tools-buttons-wrapper","?instrumentTabs":".js-instrument-tab","?subTabs":".js-sub-tab-link"},events:{"?click .js-main-share-opener":"_fireShare"},initialize:function(t,n){var e=this;r.prototype.initialize.call(this,t),this._instrumentId=n,a.on("updateInstrumentToolsButtonsEv",function(t){return i.isIn(t,e._instrumentId)&&e._updateWatchingButtons()})},render:function(){var t=this;r.prototype.render.call(this);var n=s.get("GTMData").pageType;return s.loadInstrumentData({name:this._dom.portfolioButtonWrapper.data("instrument-name"),type:this._dom.portfolioButtonWrapper.data("instrument-type"),pId:this._instrumentId}),this._dom.watchButton.on("click",function(){a.openPortfolioPopup(t._instrumentId,t._dom.portfolioButtonWrapper,!1,l),t.GTM("InstrumentPageWatchButton",t._instrumentId,n)}),this._dom.watchingButton.on("click",function(){a.openPortfolioPopup(t._instrumentId,t._dom.portfolioButtonWrapper,!1,l),t.GTM("InstrumentPageWatchButton",t._instrumentId,n)}),this._dom.alertButton.on("click",function(){e.openSinglePairPopup(t._instrumentId,l),t.GTM("InstrumentPageAddAlert",t._instrumentId)}),this._dom.instrumentTabs.exists()&&this._bindTabsAndSubTabsGTMclicks(),this.$el},destroy:function(){a.off("updateInstrumentToolsButtonsEv")},getInstrumentDetails:function(){var t=s.get("instrumentData"),n=t.instrumentName,e=t.instrumentSymbol,i=t.instrumentType;return[this._instrumentId,5,n,e,i]},_updateWatchingButtons:function(){var t=a.isPairInPortfolios(this._instrumentId);this._dom.watchButton.tCl("hide",t),this._dom.watchingButton.tCl("hide",!t)},_bindTabsAndSubTabsGTMclicks:function(){var n=this;i.e$(this._dom.instrumentTabs,function(t){t.on("click",function(){return n.GTM("InstrumentTabClicked",l,t.data("gtm-key"),n._instrumentId)})}),i.e$(this._dom.subTabs,function(t){return t.on("click",function(){return n.GTM("InstrumentSubTabClicked",l,t.data("gtm-key"),n._instrumentId)})})},_fireShare:function(t){var n=t.currentTarget,e=o(n).data(),i=e.url,r=e.title,s=e.desc;u.trigger("FireShareEv",i,r,s)}})});